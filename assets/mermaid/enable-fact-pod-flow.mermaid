---
config:
  look: neo
  theme: redux
---

sequenceDiagram
    actor User
    participant LLM as AI Assistant
    participant Gateway as Gateway<br>[OpenProfile]
    participant FactPod as Site.com<br>[OpenProfile Fact Pod]

%% Step 1 — User requests enabling
    User->>LLM: "Enable Fact Pod for Site.com"

%% Step 2 — LLM triggers enable process
    LLM->>Gateway: enableFactPod(site)

%% Step 3 — Gateway performs checks
    Gateway->>FactPod: (1) Check OpenProfile compatibility
    Gateway->>FactPod: (2) Register as OAuth client
    FactPod-->>Gateway: (3) OAuth client_id, client_secret, redirect_url

%% Step 4 — Store config & prepare authorization
    Gateway->>Gateway: Save OAuth client credentials
    Gateway->>Gateway: Generate authorization URL
    Gateway-->>LLM: Return authorization URL
    LLM-->>User: Present authorization link

%% Step 5 — User authorization with Fact Pod
    User->>FactPod: (4) Authorize & select facts to share
    Note right of FactPod: User logs in and chooses data to share

%% Step 6 — OAuth callback
    FactPod-->>Gateway: (5) Redirect with authorization code
    Gateway->>FactPod: (6) Exchange code for access/refresh tokens
    FactPod-->>Gateway: (7) Return tokens
    Gateway->>Gateway: Store tokens securely

%% Step 7 — Completion
    Gateway-->>LLM: Notify AI Assistant of activation